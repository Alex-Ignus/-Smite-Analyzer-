<html>
<head>
	<title></title>
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
	<style type="text/css">
		*,
		*:before,
		*:after {
		  box-sizing: border-box;
		}
		html,
		body {
		  width: 100%;
		  height: 100%;
		  margin: 0;
		}
		nav {
		  position: fixed;
		  width: 100%;
		  top: 0;
		  padding: 16px;
		  z-index: 100;
		}
		nav .up {
		  font: bold 14px/1 sans-serif;
		  color: white;
		  width: 92px;
		  padding: 8px;
		  background-color: rgba(230, 26, 60, 0.8);
		  float: left;
		  cursor: pointer;
		}
		nav .up:hover {
		  background-color: rgba(184, 20, 48, 0.8);
		}
		.feature {
		  position: relative;
		  width: calc(100% - 0 * 2 * 1px);
		  height: calc(100% - 0 * 2 * 1px);
		  margin: 0px;
		  overflow: hidden;
		}
		.node {
		  position: absolute;
		  background: transparent url("") no-repeat 50%/cover;
		  overflow: hidden;
		  opacity: 0.8;
		  transition: opacity 0.8s;
		  cursor: pointer;
		}
		.node .label {
		  display: inline;
		  font-family: sans-serif;
		  color: rgba(255, 255, 255, 0.6);
		  position: absolute;
		  padding: 0;
		  margin: 0;
		  top: 50%;
		  left: 50%;
		  transform: translateX(-50%) translateY(-50%);
		  transition: color 0.4s, opacity 0.8s, filter 0.8s;
		}
		.node.hide {
		  opacity: 0;
		  pointer-events: none;
		}
		.node.hide .label {
		  filter: blur(10px);
		}
		.node:hover .label {
		  color: white;
		}
		.node.level-0 {
		  z-index: 4;
		  font-size: 15vmin;
		  display: none;
		}
		.node.level-1 {
		  z-index: 3;
		  font-size: 10vmin;
		}
		.node.level-2 {
		  z-index: 2;
		  font-size: 5vmin;
		}
		.node.level-3 {
		  z-index: 1;
		  font-size: 2.5vmin;
		}
		div.tooltip { 
	      position: absolute;     
	      text-align: center;     
	      width: fit-content;
	      height: fit-content;
	      padding: 10px;     
	      font: 12px sans-serif;    
	      background: lightsteelblue; 
	      border: 0px;    
	      border-radius: 8px;     
	      pointer-events: none;
	      z-index: 9;  
	    }
	</style>
	<script src="https://www.gstatic.com/firebasejs/8.4.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.4.2/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.4.2/firebase-firestore.js"></script>
    <script type="text/javascript">
        var firebaseConfig = {
            apiKey: "AIzaSyCQr6mE-PZzYiDwhNgCDwuDVGdDvPQ7P6M",
            authDomain: "puppyplayground.firebaseapp.com",
            projectId: "puppyplayground",
            storageBucket: "puppyplayground.appspot.com",
            messagingSenderId: "201968710980",
            appId: "1:201968710980:web:c114c4912ef98e02739311",
            measurementId: "G-SFMQ6K9778"
        };
        firebase.initializeApp(firebaseConfig);
        const smiteDB = firebase.firestore();
    </script>
</head>
<body>
<nav>
	<div class="up">UP</div>
</nav>
<div class="feature" id="chart"></div>

<script type="text/javascript">

smiteDB.collection('test_Bubblechart').get().then( res =>{  
    console.log(res)
    var data = {
        "name": "Matchs",
        "children": [
          {
            "name": "Arena",
            "value": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Arena.mapValue.fields.matchCount.integerValue),
            "children": [
              {
                "Kcount": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Arena.mapValue.fields.Roles.mapValue.fields.Assassin.mapValue.fields.count.integerValue),
                "name": "Assassin",
                "value": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Arena.mapValue.fields.Roles.mapValue.fields.Assassin.mapValue.fields.kcount.integerValue)
              },
              {
              	"Kcount": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Arena.mapValue.fields.Roles.mapValue.fields.Guardian.mapValue.fields.count.integerValue),
                "name": "Guardian",
                "value": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Arena.mapValue.fields.Roles.mapValue.fields.Guardian.mapValue.fields.count.integerValue)
              },
              {
              	"Kcount": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Arena.mapValue.fields.Roles.mapValue.fields.Hunter.mapValue.fields.count.integerValue),
                "name": "Hunter",
                "value": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Arena.mapValue.fields.Roles.mapValue.fields.Hunter.mapValue.fields.count.integerValue)
              },
              {
              	"Kcount": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Arena.mapValue.fields.Roles.mapValue.fields.Mage.mapValue.fields.count.integerValue),
                "name": "Mage",
                "value": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Arena.mapValue.fields.Roles.mapValue.fields.Mage.mapValue.fields.count.integerValue)
              },
              {
              	"Kcount": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Arena.mapValue.fields.Roles.mapValue.fields.Warrior.mapValue.fields.count.integerValue),
                "name": "Warrior",
                "value": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Arena.mapValue.fields.Roles.mapValue.fields.Warrior.mapValue.fields.count.integerValue)
              }
            ]
          },
          {
            "name": "Clash",
            "value": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Clash.mapValue.fields.matchCount.integerValue),
            "children": [
                {
                  "Kcount": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Clash.mapValue.fields.Roles.mapValue.fields.Assassin.mapValue.fields.count.integerValue),
                  "name": "Assassin",
                  "value": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Clash.mapValue.fields.Roles.mapValue.fields.Assassin.mapValue.fields.count.integerValue)
                },
                {
                  "Kcount": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Clash.mapValue.fields.Roles.mapValue.fields.Guardian.mapValue.fields.count.integerValue),
                  "name": "Guardian",
                  "value": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Clash.mapValue.fields.Roles.mapValue.fields.Guardian.mapValue.fields.count.integerValue)
                },
                {
                  "Kcount": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Clash.mapValue.fields.Roles.mapValue.fields.Hunter.mapValue.fields.count.integerValue),
                  "name": "Hunter",
                  "value": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Clash.mapValue.fields.Roles.mapValue.fields.Hunter.mapValue.fields.count.integerValue)
                },
                {
                  "Kcount": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Clash.mapValue.fields.Roles.mapValue.fields.Mage.mapValue.fields.count.integerValue),
                  "name": "Mage",
                  "value": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Clash.mapValue.fields.Roles.mapValue.fields.Mage.mapValue.fields.count.integerValue)
                },
                {
                  "Kcount": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Clash.mapValue.fields.Roles.mapValue.fields.Warrior.mapValue.fields.count.integerValue),
                  "name": "Warrior",
                  "value": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Clash.mapValue.fields.Roles.mapValue.fields.Warrior.mapValue.fields.count.integerValue)
                }
              ]
          },
          {
            "name": "Conquest",
            "value": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Conquest.mapValue.fields.matchCount.integerValue),
            "children": [
                {
                  "Kcount": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Conquest.mapValue.fields.Roles.mapValue.fields.Assassin.mapValue.fields.count.integerValue),
                  "name": "Assassin",
                  "value": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Conquest.mapValue.fields.Roles.mapValue.fields.Assassin.mapValue.fields.count.integerValue)
                },
                {
                  "Kcount": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Conquest.mapValue.fields.Roles.mapValue.fields.Guardian.mapValue.fields.count.integerValue),
                  "name": "Guardian",
                  "value": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Conquest.mapValue.fields.Roles.mapValue.fields.Guardian.mapValue.fields.count.integerValue)
                },
                {
                  "Kcount": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Conquest.mapValue.fields.Roles.mapValue.fields.Hunter.mapValue.fields.count.integerValue),
                  "name": "Hunter",
                  "value": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Conquest.mapValue.fields.Roles.mapValue.fields.Hunter.mapValue.fields.count.integerValue)
                },
                {
                  "Kcount": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Conquest.mapValue.fields.Roles.mapValue.fields.Mage.mapValue.fields.count.integerValue),
                  "name": "Mage",
                  "value": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Conquest.mapValue.fields.Roles.mapValue.fields.Mage.mapValue.fields.count.integerValue)
                },
                {
                  "Kcount": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Conquest.mapValue.fields.Roles.mapValue.fields.Warrior.mapValue.fields.count.integerValue),
                  "name": "Warrior",
                  "value": parseInt(res.docs[0]._delegate._document.data.partialValue.mapValue.fields.matchTypes.mapValue.fields.Conquest.mapValue.fields.Roles.mapValue.fields.Warrior.mapValue.fields.count.integerValue)
                }
              ]
          }
        ]
      };
	var makeChart = ()=>{
		var width = height = 100,
			x = d3.scaleLinear().domain([0, width]).range([0, width]),
		    y = d3.scaleLinear().domain([0, height]).range([0, height]),
			color = d3.scaleOrdinal()
				.range(d3.schemeDark2
					.map(function(c) {
						c = d3.rgb(c);
						return c; 
					})
				),
		treemap = d3.treemap()
	    	.size([width, height])
	    	.paddingInner(0)
	    	.round(false),
		nodes = d3.hierarchy(data)
			.sum(function(d) { return d.value ? 1 : 0; }),
		currentDepth;

		treemap(nodes);

		var div = d3.select("body").append("div") 
		    .attr("class", "tooltip")       
		    .style("opacity", 0);

		var chart = d3.select("#chart");
		var cells = chart
				.selectAll(".node")
				.data(nodes.descendants())
				.enter()
				.append("div")
				.attr("class", function(d) { return "node level-" + d.depth;})
				.attr("title", function(d) { return d.name ? d.name : "null";});
			cells
				.style("left", function(d) { return x(d.x0) + "%"; })
				.style("top", function(d) { return y(d.y0) + "%"; })
				.style("width", function(d) { return x(d.x1) - x(d.x0) + "%"; })
				.style("height", function(d) { return y(d.y1) - y(d.y0) + "%"; })
				.style("background-color", function(d) { while (d.depth > 2) d = d.parent; return color(d.data.name); })
				.append("p")
				.attr("class", "label")
				.text(function(d) { return d.data.name ? d.data.name : "---"; })
				d3.selectAll('.level-1')
				.on("click", zoom);
				d3.selectAll('.level-2')
				.on("mouseover", function(d) {
			      div.transition().duration(200).style("opacity", .9);    
			      div .html( 'Player Kills:  ' + d.data.Kcount)
			          .style("left", (d3.event.pageX) + "px")   
			          .style("top", (d3.event.pageY - 28) + "px");
			    })      
			    .on("mouseout", function(d) {
			      div.transition()
			         .duration(500)
			         .style("opacity", 0);
			    });
			var parent = d3.select(".up")
				.datum(nodes)
				.on("click", zoom);

		function zoom(d) {
			currentDepth = d.depth;
			parent.datum(d.parent || nodes);
			x.domain([d.x0, d.x1]);
			y.domain([d.y0, d.y1]);
			var t = d3.transition()
		    	.duration(800)
		    	.ease(d3.easeCubicOut);
			cells
				.transition(t)
				.style("left", function(d) { return x(d.x0) + "%"; })
				.style("top", function(d) { return y(d.y0) + "%"; })
				.style("width", function(d) { return x(d.x1) - x(d.x0) + "%"; })
				.style("height", function(d) { return y(d.y1) - y(d.y0) + "%"; });
			cells
				.filter(function(d) { return d.ancestors(); })
				.classed("hide", function(d) { return d.children ? true : false });
			cells
				.filter(function(d) { return d.depth > currentDepth; })
				.classed("hide", false);
		};
	};
	makeChart();
});
</script>

</body>
</html>